{% extends "base.html" %}

{% block title %}View Email - QuMail{% endblock %}

{% block content %}
<style>
    /* Reuse the same color palette and design system */
    :root {
        --primary-green: #6B6B35;
        --primary-blue: #737773;
        --neutral-gray: #A6A6A6;
        --neutral-light: #CECECE;
        --accent-gold: #C59059;
        --text-dark: #333334;
        --glass-bg: rgba(167, 167, 167, 0.1);
        --glass-border: rgba(167, 167, 167, 0.2);
    }

    body {
        background: linear-gradient(135deg, var(--neutral-light) 0%, #f8f8f8 100%);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .email-container {
        display: flex;
        min-height: 100vh;
    }

    .sidebar {
        width: 280px;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border-right: 1px solid var(--glass-border);
        position: fixed;
        height: 100vh;
        left: 0;
        top: 0;
        z-index: 1000;
        padding: 2rem 0;
    }

    .sidebar-header {
        padding: 0 2rem 2rem;
        border-bottom: 1px solid var(--glass-border);
        margin-bottom: 2rem;
    }

    .sidebar-logo {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary-green);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .nav-item {
        margin-bottom: 0.5rem;
    }

    .nav-link {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 1.5rem;
        color: var(--text-dark);
        text-decoration: none;
        border-radius: 16px;
        transition: all 0.3s ease;
        margin: 0 1rem;
    }

    .nav-link:hover {
        background: rgba(107, 107, 53, 0.1);
        transform: translateX(8px);
        color: var(--primary-green);
    }

    .nav-link.active {
        background: linear-gradient(135deg, var(--primary-green), var(--accent-gold));
        color: white;
    }

    .main-content {
        flex: 1;
        margin-left: 280px;
        padding: 2rem;
    }

    .email-header {
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        padding: 2rem;
        border-radius: 24px;
        border: 1px solid var(--glass-border);
        margin-bottom: 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .email-title {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--text-dark);
        margin: 0;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .email-icon {
        color: var(--accent-gold);
        filter: drop-shadow(0 0 10px rgba(197, 144, 89, 0.3));
    }

    .btn-glass {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 12px;
        padding: 0.8rem 1.5rem;
        color: var(--text-dark);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        font-weight: 500;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .btn-glass:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        border-color: var(--primary-green);
        color: var(--primary-green);
        text-decoration: none;
    }

    .email-content {
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .email-meta {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .meta-section {
        background: rgba(255, 255, 255, 0.6);
        border-radius: 16px;
        padding: 1.5rem;
    }

    .meta-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .meta-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--glass-border);
    }

    .meta-item:last-child {
        border-bottom: none;
    }

    .meta-label {
        font-weight: 600;
        color: var(--neutral-gray);
        font-size: 0.9rem;
    }

    .meta-value {
        color: var(--text-dark);
        font-weight: 500;
        font-size: 0.9rem;
    }

    .email-type-badge {
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .email-type-sent {
        background: rgba(14, 165, 233, 0.1);
        color: #0ea5e9;
    }

    .email-type-received {
        background: rgba(107, 107, 53, 0.1);
        color: var(--primary-green);
    }

    .encryption-badge {
        background: rgba(34, 197, 94, 0.1);
        color: #16a34a;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .email-body {
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        padding: 2rem;
        margin-top: 2rem;
        line-height: 1.6;
        color: var(--text-dark);
        font-size: 1rem;
    }

    .key-info {
        background: rgba(197, 144, 89, 0.05);
        border: 1px solid rgba(197, 144, 89, 0.2);
        border-radius: 12px;
        padding: 1rem;
        margin-top: 1rem;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.85rem;
        color: var(--text-dark);
    }

    nav.navbar { display: none; }
    main.container { padding: 0; margin: 0; max-width: 100%; }

    @media (max-width: 768px) {
        .sidebar { transform: translateX(-100%); }
        .main-content { margin-left: 0; }
        .email-meta { grid-template-columns: 1fr; }
        .email-header { flex-direction: column; gap: 1rem; }
    }
</style>

<div class="email-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <a href="{{ url_for('dashboard') }}" class="sidebar-logo">
                <i class="fas fa-shield-alt"></i>
                QuMail
            </a>
        </div>
        
        <nav class="sidebar-nav">
            <div class="nav-item">
                <a href="{{ url_for('dashboard') }}" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="{{ url_for('compose') }}" class="nav-link">
                    <i class="fas fa-edit"></i>
                    <span>Compose</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="{{ url_for('inbox') }}" class="nav-link active">
                    <i class="fas fa-inbox"></i>
                    <span>Inbox</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="{{ url_for('keys') }}" class="nav-link">
                    <i class="fas fa-key"></i>
                    <span>Keys</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="{{ url_for('debug_keys_page') }}" class="nav-link">
                    <i class="fas fa-bug"></i>
                    <span>Debug</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="{{ url_for('settings') }}" class="nav-link">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="email-header">
            <h1 class="email-title">
                <i class="fas fa-envelope email-icon"></i>
                Email Details
            </h1>
            <a href="{{ url_for('inbox') }}" class="btn-glass">
                <i class="fas fa-arrow-left"></i>
                Back to Inbox
            </a>
        </div>

        <!-- Email Content -->
        <div class="email-content">
            {% if email %}
                <!-- Email Metadata -->
                <div class="email-meta">
                    <!-- Basic Information -->
                    <div class="meta-section">
                        <div class="meta-title">
                            <i class="fas fa-info-circle"></i>
                            Message Information
                        </div>
                        
                        <div class="meta-item">
                            <span class="meta-label">Subject</span>
                            <span class="meta-value">{{ email.subject }}</span>
                        </div>
                        
                        <div class="meta-item">
                            <span class="meta-label">From</span>
                            <span class="meta-value">{{ email.sender }}</span>
                        </div>
                        
                        {% if email.recipient %}
                        <div class="meta-item">
                            <span class="meta-label">To</span>
                            <span class="meta-value">{{ email.recipient }}</span>
                        </div>
                        {% endif %}
                        
                        <div class="meta-item">
                            <span class="meta-label">Date</span>
                            <span class="meta-value">{{ email.timestamp }}</span>
                        </div>
                    </div>

                    <!-- Security Information -->
                    <div class="meta-section">
                        <div class="meta-title">
                            <i class="fas fa-shield-alt"></i>
                            Security Details
                        </div>
                        
                        <div class="meta-item">
                            <span class="meta-label">Type</span>
                            <span class="meta-value">
                                {% if email.type == 'sent' %}
                                    <span class="email-type-badge email-type-sent">
                                        <i class="fas fa-paper-plane"></i> Sent
                                    </span>
                                {% else %}
                                    <span class="email-type-badge email-type-received">
                                        <i class="fas fa-inbox"></i> Received
                                    </span>
                                {% endif %}
                            </span>
                        </div>
                        
                        <div class="meta-item">
                            <span class="meta-label">Encryption</span>
                            <span class="meta-value">
                                <span class="encryption-badge">
                                    <i class="fas fa-lock"></i> Quantum Encrypted
                                </span>
                            </span>
                        </div>
                        
                        {% if email.key_id %}
                        <div class="meta-item">
                            <span class="meta-label">Key ID</span>
                            <span class="meta-value" style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;">{{ email.key_id[:16] }}...</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}

            <!-- Message Content Section -->
            <div class="meta-section" style="margin-top: 2rem;">
                <div class="meta-title">
                    <i class="fas fa-file-text"></i>
                    Message Content
                </div>
                
                {% if decrypted_content and not decrypted_content.startswith('Content is encrypted') %}
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 1rem; margin-bottom: 1rem;">
                        <i class="fas fa-check-circle" style="color: #16a34a; margin-right: 0.5rem;"></i>
                        <span style="color: #16a34a; font-weight: 600;">Message successfully decrypted</span>
                    </div>
                    <div class="email-body">
                        {{ decrypted_content }}
                    </div>
                {% elif decrypted_content %}
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 1rem; margin-bottom: 1rem;">
                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b; margin-right: 0.5rem;"></i>
                        <span style="color: #f59e0b; font-weight: 600;">{{ decrypted_content }}</span>
                    </div>
                    <div class="email-body">
                        <p style="font-weight: 600; margin-bottom: 1rem;">Possible causes:</p>
                        <ul style="margin-bottom: 1rem; color: var(--neutral-gray);">
                            <li>The encryption key may have been deleted</li>
                            <li>The key may have expired</li>
                            <li>You may not have access to this key</li>
                            <li>The encryption format may be incompatible</li>
                        </ul>
                        {% if email and (email.content or email.encrypted_content) %}
                        <p style="font-weight: 600; margin-bottom: 0.5rem;">Encrypted Content (first 200 chars):</p>
                        <div class="key-info">{{ (email.content or email.encrypted_content)[:200] }}{% if (email.content or email.encrypted_content)|length > 200 %}...{% endif %}</div>
                        {% endif %}
                    </div>
                {% elif email and (email.content or email.encrypted_content) %}
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 1rem; margin-bottom: 1rem;">
                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b; margin-right: 0.5rem;"></i>
                        <span style="color: #f59e0b; font-weight: 600;">Content is encrypted - decryption key not found or invalid</span>
                    </div>
                    <div class="email-body">
                        <p style="font-weight: 600; margin-bottom: 0.5rem;">Encrypted Content (first 200 chars):</p>
                        <div class="key-info">{{ (email.content or email.encrypted_content)[:200] }}{% if (email.content or email.encrypted_content)|length > 200 %}...{% endif %}</div>
                    </div>
                {% else %}
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 1rem;">
                        <i class="fas fa-info-circle" style="color: #3b82f6; margin-right: 0.5rem;"></i>
                        <span style="color: #3b82f6; font-weight: 600;">No content available for this email</span>
                    </div>
                {% endif %}
            </div>

            <!-- IPFS Documents Section -->
            {% if email and email.ipfs_hash %}
            <div class="meta-section" style="margin-top: 2rem;">
                <div class="meta-title">
                    <i class="fas fa-cloud"></i>
                    IPFS Documents
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr auto; gap: 1.5rem; align-items: start; margin-bottom: 1rem;">
                    <div>
                        <p style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem;">IPFS Hash:</p>
                        <div class="key-info" style="margin: 0;">{{ email.ipfs_hash }}</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <a href="https://gateway.pinata.cloud/ipfs/{{ email.ipfs_hash }}" 
                           target="_blank" class="btn-glass" style="font-size: 0.85rem; padding: 0.6rem 1rem;">
                            <i class="fas fa-external-link-alt"></i> View on IPFS
                        </a>
                        <button class="btn-glass" onclick="loadIPFSContent()" style="font-size: 0.85rem; padding: 0.6rem 1rem;">
                            <i class="fas fa-download"></i> Load Content
                        </button>
                    </div>
                </div>
                
                {% if ipfs_document %}
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 1rem; margin-bottom: 1rem;">
                        <i class="fas fa-check-circle" style="color: #16a34a; margin-right: 0.5rem;"></i>
                        <span style="color: #16a34a; font-weight: 600;">IPFS document retrieved successfully</span>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.8); border: 1px solid var(--glass-border); border-radius: 12px; padding: 1.5rem;">
                        <h6 style="color: var(--text-dark); margin-bottom: 1rem; font-weight: 600;">Document Content:</h6>
                        <pre style="white-space: pre-wrap; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; max-height: 400px; overflow-y: auto; background: rgba(0,0,0,0.05); padding: 1rem; border-radius: 8px; margin: 0;">{{ ipfs_document | tojson(indent=2) }}</pre>
                    </div>
                    
                    <!-- Show attachments if they exist -->
                    {% if ipfs_document.data and ipfs_document.data.attachments %}
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 1rem; margin: 1rem 0;">
                        <i class="fas fa-paperclip" style="color: #3b82f6; margin-right: 0.5rem;"></i>
                        <span style="color: #3b82f6; font-weight: 600;">This email contains {{ ipfs_document.data.attachments|length }} attachment(s)</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                        {% for attachment in ipfs_document.data.attachments %}
                        <div style="background: rgba(255, 255, 255, 0.6); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.5rem;">
                            <h6 style="color: var(--text-dark); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-file" style="color: var(--accent-gold);"></i> {{ attachment.filename }}
                            </h6>
                            <div style="color: var(--neutral-gray); font-size: 0.9rem; margin-bottom: 1rem;">
                                <div>Size: {{ attachment.size }} bytes</div>
                                <div>Type: {{ attachment.content_type }}</div>
                            </div>
                            <a href="{{ attachment.gateway_url }}" target="_blank" class="btn-glass" style="font-size: 0.85rem; padding: 0.6rem 1rem; margin-bottom: 0.75rem;">
                                <i class="fas fa-download"></i> Download
                            </a>
                            <div class="key-info" style="font-size: 0.75rem; margin: 0;">{{ attachment.ipfs_hash }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                {% else %}
                    <div id="ipfsContent" style="display: none;">
                        <div style="background: rgba(255, 255, 255, 0.8); border: 1px solid var(--glass-border); border-radius: 12px; padding: 1.5rem; margin-top: 1rem;">
                            <h6 style="color: var(--text-dark); margin-bottom: 1rem; font-weight: 600;">Document Content:</h6>
                            <div id="ipfsData"></div>
                        </div>
                    </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Blockchain Verification Section -->
            {% if email and email.blockchain_hash %}
            <div class="meta-section" style="margin-top: 2rem;">
                <div class="meta-title">
                    <i class="fas fa-link"></i>
                    Blockchain Verification
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <p style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem;">Transaction Hash:</p>
                    <div class="key-info" style="margin-bottom: 1rem;">{{ email.blockchain_hash }}</div>
                    <a href="https://amoy.polygonscan.com/tx/{{ email.blockchain_hash }}" 
                       target="_blank" class="btn-glass">
                        <i class="fas fa-external-link-alt"></i> View on PolygonScan
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- Action Buttons Section -->
            <div class="meta-section" style="margin-top: 2rem;">
                <div class="meta-title">
                    <i class="fas fa-tools"></i>
                    Quick Actions
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                        {% if email and email.type == 'received' %}
                            <button class="btn-glass" onclick="replyToEmail()" style="background: rgba(59, 130, 246, 0.1); border-color: #3b82f6; color: #3b82f6;">
                                <i class="fas fa-reply"></i> Reply
                            </button>
                            <button class="btn-glass" onclick="forwardEmail()">
                                <i class="fas fa-share"></i> Forward
                            </button>
                        {% endif %}
                    </div>
                    <div>
                        <button class="btn-glass" onclick="deleteThisEmail()" style="background: rgba(239, 68, 68, 0.1); border-color: #ef4444; color: #ef4444;">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
</div>

<script>
function loadIPFSContent() {
    const ipfsHash = '{{ email.ipfs_hash if email else "" }}';
    if (!ipfsHash) {
        showNotification('No IPFS hash available', 'error');
        return;
    }
    
    // Show loading state
    document.getElementById('ipfsData').innerHTML = `
        <div style="text-align: center; padding: 2rem; color: var(--primary-blue);">
            <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; margin-bottom: 1rem;"></i>
            <div style="font-weight: 600;">Loading IPFS content...</div>
        </div>
    `;
    document.getElementById('ipfsContent').style.display = 'block';
    
    // Try multiple IPFS gateways
    const gateways = [
        `https://gateway.pinata.cloud/ipfs/${ipfsHash}`,
        `https://ipfs.io/ipfs/${ipfsHash}`,
        `https://dweb.link/ipfs/${ipfsHash}`
    ];
    
    let gatewayIndex = 0;
    
    function tryNextGateway() {
        if (gatewayIndex >= gateways.length) {
            document.getElementById('ipfsData').innerHTML = `
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 1rem; text-align: center;">
                    <i class="fas fa-exclamation-circle" style="color: #ef4444; margin-right: 0.5rem;"></i>
                    <span style="color: #ef4444; font-weight: 600;">Failed to load content from all IPFS gateways</span>
                </div>
            `;
            return;
        }
        
        fetch(gateways[gatewayIndex])
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('ipfsData').innerHTML = 
                    '<pre style="white-space: pre-wrap; font-family: \'JetBrains Mono\', monospace; font-size: 0.85rem; max-height: 400px; overflow-y: auto; background: rgba(0,0,0,0.05); padding: 1rem; border-radius: 8px; margin: 0;">' + 
                    JSON.stringify(data, null, 2) + '</pre>';
                showNotification('IPFS content loaded successfully', 'success');
            })
            .catch(error => {
                console.log(`Gateway ${gatewayIndex + 1} failed:`, error);
                gatewayIndex++;
                tryNextGateway();
            });
    }
    
    tryNextGateway();
}

function replyToEmail() {
    const recipient = '{{ email.sender if email else "" }}';
    const subject = 'Re: {{ email.subject if email else "" }}';
    window.location.href = `/compose?recipient=${encodeURIComponent(recipient)}&subject=${encodeURIComponent(subject)}`;
}

function forwardEmail() {
    const subject = 'Fwd: {{ email.subject if email else "" }}';
    window.location.href = `/compose?subject=${encodeURIComponent(subject)}`;
}

function deleteThisEmail() {
    if (confirm('Are you sure you want to delete this email?')) {
        showNotification('Deleting email...', 'info');
        fetch(`/api/email/{{ email.id if email else 0 }}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Email deleted successfully', 'success');
                setTimeout(() => {
                    window.location.href = '{{ url_for("inbox") }}';
                }, 1000);
            } else {
                showNotification('Failed to delete email: ' + data.error, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('An error occurred while deleting the email', 'error');
        });
    }
}

// Notification system
function showNotification(message, type = 'info') {
    // Remove existing notifications
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notification => notification.remove());
    
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(15px);
        border: 1px solid var(--neutral-light);
        border-radius: 12px;
        padding: 12px 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        color: var(--text-dark);
        font-weight: 500;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
        max-width: 300px;
    `;
    
    if (type === 'success') {
        notification.style.borderColor = '#22c55e';
        notification.innerHTML = `<i class="fas fa-check-circle" style="color: #22c55e; margin-right: 8px;"></i>${message}`;
    } else if (type === 'error') {
        notification.style.borderColor = '#ef4444';
        notification.innerHTML = `<i class="fas fa-exclamation-circle" style="color: #ef4444; margin-right: 8px;"></i>${message}`;
    } else {
        notification.style.borderColor = 'var(--primary-blue)';
        notification.innerHTML = `<i class="fas fa-info-circle" style="color: var(--primary-blue); margin-right: 8px;"></i>${message}`;
    }
    
    document.body.appendChild(notification);
    
    // Animate in
    requestAnimationFrame(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
    });
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}
</script>
{% endblock %}